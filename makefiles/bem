### Variables ##

# Enb
ENB := $(NODE_MODULES_BIN_PATH)/enb

# Borschik
BORSCHIK := $(NODE_MODULES_BIN_PATH)/borschik

# Static path
STATIC_PATH := public/static

### Rules ###

# Make bem techs
.PHONY: bem
bem: static-dir.delete bem-configs.create bem-make freeze-links

# Bem make
.PHONY: bem-make
bem-make:
	$(ENB) make ${tech} --no-cache --dir $(BEM_DIR)

# Create bem configs
.PHONY: bem-configs.create
bem-configs.create:
	@echo '===> Creating bem configs'

	ln -sf $(PWD)/$(NODE_MODULES_PATH)/app-bem-dev/borschik.json $(PWD)/$(BEM_DIR)/.borschik

# Freeze links
.PHONY: freeze-links
freeze-links:
	ln -sf $(PWD)/$(NODE_MODULES_PATH)/app-bem-dev/links.json $(PWD)/$(BEM_DIR)/links.tmp.json
	$(BORSCHIK) -t json -i $(BEM_DIR)/links.tmp.json -o $(BEM_DIR)/links.json
	rm $(BEM_DIR)/links.tmp.json

# Clean bem techs
.PHONY: bem-techs.clean
bem-techs.clean:
	@echo '===> Cleaning bem bundles'

	$(ENB) make clean --dir $(BEM_DIR)

.PHONY: bem-configs.delete
bem-configs.delete:
	@echo '===> Deleting bem configs'

	rm -f $(BEM_DIR)/.borschik
	rm -f $(BEM_DIR)/links.json

# Create static dir
.PHONY: static-dir.create
static-dir.create:
	@echo '===> Ð¡reating static dir'

	mkdir -p $(STATIC_PATH)

# Clean
.PHONY: clean
clean: bem-configs.delete static-dir.delete bem-techs.clean temp-files.delete

# Delete static dir
.PHONY: static-dir.delete
static-dir.delete:
	@echo '===> Deleting static dir'

	rm -rf $(STATIC_PATH)


# Delete temporary files
.PHONY: temp-files.delete
temp-files.delete:
	@echo '===> Deleting temporary files'

	rm -rf $(BEM_PATH)/.enb/tmp


